<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="orderDao">
	<insert id="insertCart" parameterType="cartVO">
		insert into cart (no, id, item, cate, pric, opti, proop, stock, regd)
		values (#{no}, #{id}, #{item}, #{cate}, #{pric}, #{opti}, #{proop}, #{stock}, systimestamp)
	</insert>
	<select id="listCart" parameterType="String" resultType="cartVO">
		select * from cart where id = #{id} order by regd desc
	</select>
	<select id="searchDupl" parameterType="cartVO" resultType="Integer">
		select count(*) from cart where no = #{no} and id = #{id} and item = #{item} and cate = #{cate} and pric = #{pric} and opti = #{opti} and proop = #{proop}
	</select>
	<update id="updateCart" parameterType="cartVO">
		update cart set no = #{no}, id = #{id}, item = #{item}, cate = #{cate}, pric = #{pric}, opti = #{opti}, proop = #{proop}, stock = #{stock}, regd = systimestamp
		where no = #{no} and id = #{id} and item = #{item} and cate = #{cate} and pric = #{pric} and opti = #{opti} and proop = #{proop} 
	</update>
	<select id="checkOrno" parameterType="String" resultType="Integer">
		select count(distinct orno) from cart where id = #{id}
	</select>
	<select id="searchOrno" parameterType="Integer" resultType="Integer">
		select count(orno) from cart where orno = #{orno}
	</select>
	<update id="updateOrno" parameterType="map">
		update cart set orno = #{orno} where id = #{id}
	</update>
	<select id="selectOrno" parameterType="String" resultType="Integer">
		select distinct orno from cart where orno is not null and id = #{id} 
	</select>
	<insert id="insertOrder" parameterType="ordersVO">
		insert into orders (no, orno, id, name, poco, addr, daddr, tel, ceph, dema, prog, regd, pame, pade)
		values (orders_seq.nextval, #{orno}, #{id}, #{name}, #{poco}, #{addr}, #{daddr}, #{tel}, #{ceph}, #{dema}, '결제대기중', systimestamp, #{pame}, #{pade})
	</insert>
	<insert id="insertOrDe" parameterType="cartVO">
		insert into orderdetail (no, id, item, cate, pric, opti, proop, stock, regd, orno)
		values (#{no}, #{id}, #{item}, #{cate}, #{pric}, #{opti}, #{proop}, #{stock}, systimestamp, #{orno})
	</insert>
	<delete id="deleteCart" parameterType="String">
		delete from cart where id = #{id}
	</delete>
	<select id="listOrders" parameterType="String" resultType="ordersVO">
		select * from orders where id = #{id} order by regd asc
	</select>
	<select id="selectOrders" parameterType="map" resultType="ordersVO">
		select * from orders where id = #{id} and orno = #{orno}
	</select>
</mapper>